"use strict";!function(r){wp.textWidgets.TextWidgetControl=Backbone.View.extend({events:{},initialize:function(t){var n=this;if(!t.el)throw new Error("Missing options.el");if(!t.syncContainer)throw new Error("Missing options.syncContainer");Backbone.View.prototype.initialize.call(n,t),n.syncContainer=t.syncContainer,n.$el.addClass("text-widget-fields"),n.$el.html(wp.template("widget-text-control-fields")),n.customHtmlWidgetPointer=n.$el.find(".wp-pointer.custom-html-widget-pointer"),n.customHtmlWidgetPointer.length&&(n.customHtmlWidgetPointer.find(".close").on("click",function(t){t.preventDefault(),n.customHtmlWidgetPointer.hide(),r("#"+n.fields.text.attr("id")+"-html").focus(),n.dismissPointers(["text_widget_custom_html"])}),n.customHtmlWidgetPointer.find(".add-widget").on("click",function(t){t.preventDefault(),n.customHtmlWidgetPointer.hide(),n.openAvailableWidgetsPanel()})),n.pasteHtmlPointer=n.$el.find(".wp-pointer.paste-html-pointer"),n.pasteHtmlPointer.length&&n.pasteHtmlPointer.find(".close").on("click",function(t){t.preventDefault(),n.pasteHtmlPointer.hide(),n.editor.focus(),n.dismissPointers(["text_widget_custom_html","text_widget_paste_html"])}),n.fields={title:n.$el.find(".title"),text:n.$el.find(".text")},_.each(n.fields,function(e,i){e.on("input change",function(){var t=n.syncContainer.find(".sync-input."+i);t.val()!==e.val()&&(t.val(e.val()),t.trigger("change"))}),e.val(n.syncContainer.find(".sync-input."+i).val())})},dismissPointers:function(t){_.each(t,function(t){wp.ajax.post("dismiss-wp-pointer",{pointer:t}),wp.textWidgets.dismissedPointers.push(t)})},openAvailableWidgetsPanel:function(){var e;wp.customize.section.each(function(t){t.extended(wp.customize.Widgets.SidebarSection)&&t.expanded()&&(e=wp.customize.control("sidebars_widgets["+t.params.sidebarId+"]"))}),e&&setTimeout(function(){wp.customize.Widgets.availableWidgetsPanel.open(e),wp.customize.Widgets.availableWidgetsPanel.$search.val("HTML").trigger("keyup")})},updateFields:function(){var t,e=this;e.fields.title.is(document.activeElement)||(t=e.syncContainer.find(".sync-input.title"),e.fields.title.val(t.val())),t=e.syncContainer.find(".sync-input.text"),e.fields.text.is(":visible")?e.fields.text.is(document.activeElement)||e.fields.text.val(t.val()):e.editor&&!e.editorFocused&&t.val()!==e.fields.text.val()&&e.editor.setContent(wp.oldEditor.autop(t.val()))},initializeEditor:function(){var o,t,s,e,d=this,c=1e3,l=!1,a=!1;t=d.fields.text,o=t.attr("id"),e=t.val(),s=function(){d.editor.isDirty()&&(wp.customize&&wp.customize.state&&(wp.customize.state("processing").set(wp.customize.state("processing").get()+1),_.delay(function(){wp.customize.state("processing").set(wp.customize.state("processing").get()-1)},300)),d.editor.isHidden()||d.editor.save()),a&&e!==t.val()&&(t.trigger("change"),a=!1,e=t.val())},d.syncContainer.closest(".widget").find("[name=savewidget]:first").on("click",function(){s()}),function t(){var e,i,n;if(document.getElementById(o))if(void 0===window.tinymce)wp.oldEditor.initialize(o,{quicktags:!0,mediaButtons:!0});else{if(tinymce.get(o)&&(l=tinymce.get(o).isHidden(),wp.oldEditor.remove(o)),r(document).one("wp-before-tinymce-init.text-widget-init",function(t,e){e.plugins&&!/\bwpview\b/.test(e.plugins)&&(e.plugins+=",wpview")}),wp.oldEditor.initialize(o,{tinymce:{wpautop:!0},quicktags:!0,mediaButtons:!0}),n=function(t){t.show(),t.find(".close").focus(),wp.a11y.speak(t.find("h3, p").map(function(){return r(this).text()}).get().join("\n\n"))},!(e=window.tinymce.get(o)))throw new Error("Failed to initialize editor");i=function(){r(e.getWin()).on("unload",function(){_.defer(t)}),l&&switchEditors.go(o,"html"),r("#"+o+"-html").on("click",function(){d.pasteHtmlPointer.hide(),-1===wp.textWidgets.dismissedPointers.indexOf("text_widget_custom_html")&&n(d.customHtmlWidgetPointer)}),r("#"+o+"-tmce").on("click",function(){d.customHtmlWidgetPointer.hide()}),e.on("pastepreprocess",function(t){t=t.content,-1===wp.textWidgets.dismissedPointers.indexOf("text_widget_paste_html")&&t&&/&lt;\w+.*?&gt;/.test(t)&&_.delay(function(){n(d.pasteHtmlPointer)},250)})},e.initialized?i():e.on("init",i),d.editorFocused=!1,e.on("focus",function(){d.editorFocused=!0}),e.on("paste",function(){e.setDirty(!0),s()}),e.on("NodeChange",function(){a=!0}),e.on("NodeChange",_.debounce(s,c)),e.on("blur hide",function(){d.editorFocused=!1,s()}),d.editor=e}}()}})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRleHQtd2lkZ2V0cy5qcyJdLCJuYW1lcyI6WyIkIiwid3AiLCJ0ZXh0V2lkZ2V0cyIsIlRleHRXaWRnZXRDb250cm9sIiwiQmFja2JvbmUiLCJWaWV3IiwiZXh0ZW5kIiwiZXZlbnRzIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJjb250cm9sIiwidGhpcyIsImVsIiwic3luY0NvbnRhaW5lciIsIkVycm9yIiwiY2FsbCIsIiRlbCIsImFkZENsYXNzIiwicHJvdG90eXBlIiwiZmluZCIsImxlbmd0aCIsImN1c3RvbUh0bWxXaWRnZXRQb2ludGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImZvY3VzIiwidGV4dCIsIm9uIiwiaGlkZSIsInBhc3RlSHRtbFBvaW50ZXIiLCJkaXNtaXNzUG9pbnRlcnMiLCJ0aXRsZSIsImZpZWxkSW5wdXQiLCJmaWVsZE5hbWUiLCJzeW5jSW5wdXQiLCJlYWNoIiwidmFsIiwicG9pbnRlcnMiLCJfIiwicG9pbnRlciIsImFqYXgiLCJwb3N0IiwicHVzaCIsIm9wZW5BdmFpbGFibGVXaWRnZXRzUGFuZWwiLCJzaWRlYmFyQ29udHJvbCIsImN1c3RvbWl6ZSIsInNlY3Rpb24iLCJleHBhbmRlZCIsInBhcmFtcyIsInNpZGViYXJJZCIsInNldFRpbWVvdXQiLCJhdmFpbGFibGVXaWRnZXRzUGFuZWwiLCJvcGVuIiwiV2lkZ2V0cyIsIiRzZWFyY2giLCJ0cmlnZ2VyIiwidXBkYXRlRmllbGRzIiwiZmllbGRzIiwiaXMiLCJkb2N1bWVudCIsImFjdGl2ZUVsZW1lbnQiLCJlZGl0b3IiLCJlZGl0b3JGb2N1c2VkIiwic2V0Q29udGVudCIsIm9sZEVkaXRvciIsImF1dG9wIiwiaW5pdGlhbGl6ZUVkaXRvciIsImlkIiwidGV4dGFyZWEiLCJ0cmlnZ2VyQ2hhbmdlSWZEaXJ0eSIsInByZXZpb3VzVmFsdWUiLCJjaGFuZ2VEZWJvdW5jZURlbGF5IiwicmVzdG9yZVRleHRNb2RlIiwibmVlZHNUZXh0YXJlYUNoYW5nZVRyaWdnZXIiLCJhdHRyIiwidXBkYXRlV2lkZ2V0QnVmZmVyIiwic3RhdGUiLCJzZXQiLCJnZXQiLCJkZWxheSIsImlzSGlkZGVuIiwic2F2ZSIsImNsb3Nlc3QiLCJnZXRFbGVtZW50QnlJZCIsIndpbmRvdyIsInRpbnltY2UiLCJxdWlja3RhZ3MiLCJtZWRpYUJ1dHRvbnMiLCJyZW1vdmUiLCJpbml0IiwicGx1Z2lucyIsInRlc3QiLCJ3cGF1dG9wIiwicG9pbnRlckVsZW1lbnQiLCJzaG93IiwibWFwIiwiam9pbiIsIm9uSW5pdCIsImExMXkiLCJkaXNtaXNzZWRQb2ludGVycyIsImluZGV4T2YiLCJzaG93UG9pbnRlckVsZW1lbnQiLCJjb250ZW50Iiwic2V0RGlydHkiLCJkZWJvdW5jZSIsImJ1aWxkRWRpdG9yIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiY0FPQSxTQUFBQSxHQUdFQyxHQUFBQyxZQUFjQyxrQkFBQUMsU0FBQUMsS0FBQUMsT0FBQSxDQU1oQkMsT0FBQSxHQWVBQyxXQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUMsS0FFRUgsSUFBQUEsRUFBWUksR0FDWCxNQUFJRixJQUFBQSxNQUFVLHNCQUVkLElBQUtELEVBQVNJLGNBQ2IsTUFBQSxJQUFNQyxNQUFJQSxpQ0FFWFYsU0FBT0ssS0FBQUEsVUFBUUksV0FBZ0JFLEtBQUFMLEVBQUFELEdBQzlCQyxFQUFBRyxjQUFpQkosRUFBQUksY0FNbEJILEVBQVFNLElBQUlDLFNBQVUsc0JBSHRCYixFQUFBQSxJQUFTQyxLQUFLYSxHQUFBQSxTQUFVViwrQkFHeEJFLEVBQUFBLHdCQUFzQkEsRUFBQU0sSUFBdEJHLEtBQUEsMENBQ0FULEVBQVFNLHdCQUF1QkksU0FFL0JWLEVBQUFBLHdCQUFRVyxLQUEwQlgsVUFBWVMsR0FBTSxRQUFBLFNBQUFHLEdBR2xEQSxFQUFNQyxpQkFGUmIsRUFBS0Esd0JBQVFXLE9BQ1pYLEVBQUFBLElBQUFBLEVBQVFXLE9BQUFBLEtBQUFBLEtBQXdCRixNQUFNLFNBQWVLLFFBQ3BERixFQUFBQSxnQkFBQSxDQUFBLDhCQUVB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LEdBQU9DLEVBQUFBLFFBR2ZwRixFQUFBLElBQUFrRSxFQUFBLFNBQUF4QyxHQUFBLFFBQUEsV0FlQ2hCLEVBQVFrQixpQkFBaUJELFFBWjFCLElBQUExQixHQUFBQyxZQUFBZ0csa0JBQUFDLFFBQUEsNEJBR0NDLEVBRUQxRixFQUFBVywyQkFHQ3JCLEVBQUEsSUFFRGtFLEVBQUEsU0FBQXhDLEdBQUEsUUFBQSxXQVlDaEIsRUFBUVcsd0JBQXdCTSxTQUlqQ2lDLEVBQU9sQyxHQUFJLGtCQUFtQixTQUFVSixHQVp2QytFLEVBQUsvRSxFQUFVcEIsU0FDZCxJQUFBRCxHQUFBQyxZQUFBZ0csa0JBQUFDLFFBQUEsMkJBQUFFLEdBQUEsaUJBQUFYLEtBQUFXLElBa0JEaEUsRUFBRXlDLE1BQU8sV0FaVjlFLEVBQWNVLEVBQWNrQixtQkFDM0JsQixRQUtBa0QsRUFBSXlDLFlBYUxMLElBWEVwQyxFQUFBbEMsR0FBQSxPQUFBc0UsR0FnQkh0RixFQUFRbUQsZUFBZ0IsRUFYckJ1QyxFQUFBQSxHQUFBQSxRQUFBQSxXQUNBMUYsRUFGRG1ELGVBQUEsSUFJREQsRUF2Q0RsQyxHQUFBLFFBQUEsV0FxRENrQyxFQUFPMEMsVUFBVSxHQVpsQmxDLE1BRUNSLEVBRkRsQyxHQUVPLGFBQUEsV0FDTmtDLEdBQUEsSUFlREEsRUFBT2xDLEdBQUksYUFBY1csRUFBRWtFLFNBQVVuQyxFQUFzQkUsSUFaM0Q1RCxFQUFBQSxHQUFPLFlBQUNtRCxXQUVSRCxFQUFBQSxlQUFvQixFQUNuQmxELE1BR0FrRCxFQUFBQSxPQUFPMEMsR0FFUEUsTUE1VUwsQ0ErVUtDIiwiZmlsZSI6InRleHQtd2lkZ2V0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQG91dHB1dCB3cC1hZG1pbi9qcy93aWRnZXRzL3RleHQtd2lkZ2V0cy5qc1xyXG4gKi9cclxuXHJcbi8qIGdsb2JhbCB0aW55bWNlLCBzd2l0Y2hFZGl0b3JzICovXHJcbi8qIGVzbGludCBjb25zaXN0ZW50LXRoaXM6IFsgXCJlcnJvclwiLCBcImNvbnRyb2xcIiBdICovXHJcblxyXG4vKipcclxuICogQG5hbWVzcGFjZSB3cC50ZXh0V2lkZ2V0c1xyXG4gKi9cclxuKCBmdW5jdGlvbiggJCApIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdHdwLnRleHRXaWRnZXRzLlRleHRXaWRnZXRDb250cm9sID0gQmFja2JvbmUuVmlldy5leHRlbmQoIHtcclxuXHRcdC8qKlxyXG5cdFx0ICogVmlldyBldmVudHMuXHJcblx0XHQgKlxyXG5cdFx0ICogQHR5cGUge09iamVjdH1cclxuXHRcdCAqL1xyXG5cdFx0ZXZlbnRzOiB7fSxcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIFRleHQgd2lkZ2V0IGNvbnRyb2wuXHJcblx0XHQgKlxyXG5cdFx0ICogQGNvbnN0cnVjdHMgd3AudGV4dFdpZGdldHMuVGV4dFdpZGdldENvbnRyb2xcclxuXHRcdCAqIEBhdWdtZW50cyAgIEJhY2tib25lLlZpZXdcclxuXHRcdCAqIEBhYnN0cmFjdFxyXG5cdFx0ICpcclxuXHRcdCAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucy5cclxuXHRcdCAqIEBwYXJhbSB7alF1ZXJ5fSBvcHRpb25zLmVsIC0gQ29udHJvbCBmaWVsZCBjb250YWluZXIgZWxlbWVudC5cclxuXHRcdCAqIEBwYXJhbSB7alF1ZXJ5fSBvcHRpb25zLnN5bmNDb250YWluZXIgLSBDb250YWluZXIgZWxlbWVudCB3aGVyZSBmaWVsZHMgYXJlIHN5bmNlZCBmb3IgdGhlIHNlcnZlci5cclxuXHRcdCAqXHJcblx0XHQgKiBAcmV0dXJuIHt2b2lkfVxyXG5cdFx0ICovXHJcblx0XHRpbml0aWFsaXplOiBmdW5jdGlvbiBpbml0aWFsaXplKCBvcHRpb25zICkge1xyXG5cdFx0XHR2YXIgY29udHJvbCA9IHRoaXM7XHJcblxyXG5cdFx0XHRpZiAoICEgb3B0aW9ucy5lbCApIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoICdNaXNzaW5nIG9wdGlvbnMuZWwnICk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCAhIG9wdGlvbnMuc3luY0NvbnRhaW5lciApIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoICdNaXNzaW5nIG9wdGlvbnMuc3luY0NvbnRhaW5lcicgKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0QmFja2JvbmUuVmlldy5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKCBjb250cm9sLCBvcHRpb25zICk7XHJcblx0XHRcdGNvbnRyb2wuc3luY0NvbnRhaW5lciA9IG9wdGlvbnMuc3luY0NvbnRhaW5lcjtcclxuXHJcblx0XHRcdGNvbnRyb2wuJGVsLmFkZENsYXNzKCAndGV4dC13aWRnZXQtZmllbGRzJyApO1xyXG5cdFx0XHRjb250cm9sLiRlbC5odG1sKCB3cC50ZW1wbGF0ZSggJ3dpZGdldC10ZXh0LWNvbnRyb2wtZmllbGRzJyApICk7XHJcblxyXG5cdFx0XHRjb250cm9sLmN1c3RvbUh0bWxXaWRnZXRQb2ludGVyID0gY29udHJvbC4kZWwuZmluZCggJy53cC1wb2ludGVyLmN1c3RvbS1odG1sLXdpZGdldC1wb2ludGVyJyApO1xyXG5cdFx0XHRpZiAoIGNvbnRyb2wuY3VzdG9tSHRtbFdpZGdldFBvaW50ZXIubGVuZ3RoICkge1xyXG5cdFx0XHRcdGNvbnRyb2wuY3VzdG9tSHRtbFdpZGdldFBvaW50ZXIuZmluZCggJy5jbG9zZScgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGV2ZW50ICkge1xyXG5cdFx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHRcdFx0XHRcdGNvbnRyb2wuY3VzdG9tSHRtbFdpZGdldFBvaW50ZXIuaGlkZSgpO1xyXG5cdFx0XHRcdFx0JCggJyMnICsgY29udHJvbC5maWVsZHMudGV4dC5hdHRyKCAnaWQnICkgKyAnLWh0bWwnICkuZm9jdXMoKTtcclxuXHRcdFx0XHRcdGNvbnRyb2wuZGlzbWlzc1BvaW50ZXJzKCBbICd0ZXh0X3dpZGdldF9jdXN0b21faHRtbCcgXSApO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdGNvbnRyb2wuY3VzdG9tSHRtbFdpZGdldFBvaW50ZXIuZmluZCggJy5hZGQtd2lkZ2V0JyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZXZlbnQgKSB7XHJcblx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0Y29udHJvbC5jdXN0b21IdG1sV2lkZ2V0UG9pbnRlci5oaWRlKCk7XHJcblx0XHRcdFx0XHRjb250cm9sLm9wZW5BdmFpbGFibGVXaWRnZXRzUGFuZWwoKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y29udHJvbC5wYXN0ZUh0bWxQb2ludGVyID0gY29udHJvbC4kZWwuZmluZCggJy53cC1wb2ludGVyLnBhc3RlLWh0bWwtcG9pbnRlcicgKTtcclxuXHRcdFx0aWYgKCBjb250cm9sLnBhc3RlSHRtbFBvaW50ZXIubGVuZ3RoICkge1xyXG5cdFx0XHRcdGNvbnRyb2wucGFzdGVIdG1sUG9pbnRlci5maW5kKCAnLmNsb3NlJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZXZlbnQgKSB7XHJcblx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0XHRcdFx0Y29udHJvbC5wYXN0ZUh0bWxQb2ludGVyLmhpZGUoKTtcclxuXHRcdFx0XHRcdGNvbnRyb2wuZWRpdG9yLmZvY3VzKCk7XHJcblx0XHRcdFx0XHRjb250cm9sLmRpc21pc3NQb2ludGVycyggWyAndGV4dF93aWRnZXRfY3VzdG9tX2h0bWwnLCAndGV4dF93aWRnZXRfcGFzdGVfaHRtbCcgXSApO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRjb250cm9sLmZpZWxkcyA9IHtcclxuXHRcdFx0XHR0aXRsZTogY29udHJvbC4kZWwuZmluZCggJy50aXRsZScgKSxcclxuXHRcdFx0XHR0ZXh0OiBjb250cm9sLiRlbC5maW5kKCAnLnRleHQnIClcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdC8vIFN5bmMgaW5wdXQgZmllbGRzIHRvIGhpZGRlbiBzeW5jIGZpZWxkcyB3aGljaCBhY3R1YWxseSBnZXQgc2VudCB0byB0aGUgc2VydmVyLlxyXG5cdFx0XHRfLmVhY2goIGNvbnRyb2wuZmllbGRzLCBmdW5jdGlvbiggZmllbGRJbnB1dCwgZmllbGROYW1lICkge1xyXG5cdFx0XHRcdGZpZWxkSW5wdXQub24oICdpbnB1dCBjaGFuZ2UnLCBmdW5jdGlvbiB1cGRhdGVTeW5jRmllbGQoKSB7XHJcblx0XHRcdFx0XHR2YXIgc3luY0lucHV0ID0gY29udHJvbC5zeW5jQ29udGFpbmVyLmZpbmQoICcuc3luYy1pbnB1dC4nICsgZmllbGROYW1lICk7XHJcblx0XHRcdFx0XHRpZiAoIHN5bmNJbnB1dC52YWwoKSAhPT0gZmllbGRJbnB1dC52YWwoKSApIHtcclxuXHRcdFx0XHRcdFx0c3luY0lucHV0LnZhbCggZmllbGRJbnB1dC52YWwoKSApO1xyXG5cdFx0XHRcdFx0XHRzeW5jSW5wdXQudHJpZ2dlciggJ2NoYW5nZScgKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0Ly8gTm90ZSB0aGF0IHN5bmNJbnB1dCBjYW5ub3QgYmUgcmUtdXNlZCBiZWNhdXNlIGl0IHdpbGwgYmUgZGVzdHJveWVkIHdpdGggZWFjaCB3aWRnZXQtdXBkYXRlZCBldmVudC5cclxuXHRcdFx0XHRmaWVsZElucHV0LnZhbCggY29udHJvbC5zeW5jQ29udGFpbmVyLmZpbmQoICcuc3luYy1pbnB1dC4nICsgZmllbGROYW1lICkudmFsKCkgKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogRGlzbWlzcyBwb2ludGVycyBmb3IgQ3VzdG9tIEhUTUwgd2lkZ2V0LlxyXG5cdFx0ICpcclxuXHRcdCAqIEBzaW5jZSA0LjguMVxyXG5cdFx0ICpcclxuXHRcdCAqIEBwYXJhbSB7QXJyYXl9IHBvaW50ZXJzIFBvaW50ZXIgSURzIHRvIGRpc21pc3MuXHJcblx0XHQgKiBAcmV0dXJuIHt2b2lkfVxyXG5cdFx0ICovXHJcblx0XHRkaXNtaXNzUG9pbnRlcnM6IGZ1bmN0aW9uIGRpc21pc3NQb2ludGVycyggcG9pbnRlcnMgKSB7XHJcblx0XHRcdF8uZWFjaCggcG9pbnRlcnMsIGZ1bmN0aW9uKCBwb2ludGVyICkge1xyXG5cdFx0XHRcdHdwLmFqYXgucG9zdCggJ2Rpc21pc3Mtd3AtcG9pbnRlcicsIHtcclxuXHRcdFx0XHRcdHBvaW50ZXI6IHBvaW50ZXJcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHR3cC50ZXh0V2lkZ2V0cy5kaXNtaXNzZWRQb2ludGVycy5wdXNoKCBwb2ludGVyICk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSxcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIE9wZW4gYXZhaWxhYmxlIHdpZGdldHMgcGFuZWwuXHJcblx0XHQgKlxyXG5cdFx0ICogQHNpbmNlIDQuOC4xXHJcblx0XHQgKiBAcmV0dXJuIHt2b2lkfVxyXG5cdFx0ICovXHJcblx0XHRvcGVuQXZhaWxhYmxlV2lkZ2V0c1BhbmVsOiBmdW5jdGlvbiBvcGVuQXZhaWxhYmxlV2lkZ2V0c1BhbmVsKCkge1xyXG5cdFx0XHR2YXIgc2lkZWJhckNvbnRyb2w7XHJcblx0XHRcdHdwLmN1c3RvbWl6ZS5zZWN0aW9uLmVhY2goIGZ1bmN0aW9uKCBzZWN0aW9uICkge1xyXG5cdFx0XHRcdGlmICggc2VjdGlvbi5leHRlbmRlZCggd3AuY3VzdG9taXplLldpZGdldHMuU2lkZWJhclNlY3Rpb24gKSAmJiBzZWN0aW9uLmV4cGFuZGVkKCkgKSB7XHJcblx0XHRcdFx0XHRzaWRlYmFyQ29udHJvbCA9IHdwLmN1c3RvbWl6ZS5jb250cm9sKCAnc2lkZWJhcnNfd2lkZ2V0c1snICsgc2VjdGlvbi5wYXJhbXMuc2lkZWJhcklkICsgJ10nICk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0aWYgKCAhIHNpZGViYXJDb250cm9sICkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHRzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHsgLy8gVGltZW91dCB0byBwcmV2ZW50IGNsaWNrIGV2ZW50IGZyb20gY2F1c2luZyBwYW5lbCB0byBpbW1lZGlhdGVseSBjb2xsYXBzZS5cclxuXHRcdFx0XHR3cC5jdXN0b21pemUuV2lkZ2V0cy5hdmFpbGFibGVXaWRnZXRzUGFuZWwub3Blbiggc2lkZWJhckNvbnRyb2wgKTtcclxuXHRcdFx0XHR3cC5jdXN0b21pemUuV2lkZ2V0cy5hdmFpbGFibGVXaWRnZXRzUGFuZWwuJHNlYXJjaC52YWwoICdIVE1MJyApLnRyaWdnZXIoICdrZXl1cCcgKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9LFxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogVXBkYXRlIGlucHV0IGZpZWxkcyBmcm9tIHRoZSBzeW5jIGZpZWxkcy5cclxuXHRcdCAqXHJcblx0XHQgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhdCB0aGUgd2lkZ2V0LXVwZGF0ZWQgYW5kIHdpZGdldC1zeW5jZWQgZXZlbnRzLlxyXG5cdFx0ICogQSBmaWVsZCB3aWxsIG9ubHkgYmUgdXBkYXRlZCBpZiBpdCBpcyBub3QgY3VycmVudGx5IGZvY3VzZWQsIHRvIGF2b2lkXHJcblx0XHQgKiBvdmVyd3JpdGluZyBjb250ZW50IHRoYXQgdGhlIHVzZXIgaXMgZW50ZXJpbmcuXHJcblx0XHQgKlxyXG5cdFx0ICogQHJldHVybiB7dm9pZH1cclxuXHRcdCAqL1xyXG5cdFx0dXBkYXRlRmllbGRzOiBmdW5jdGlvbiB1cGRhdGVGaWVsZHMoKSB7XHJcblx0XHRcdHZhciBjb250cm9sID0gdGhpcywgc3luY0lucHV0O1xyXG5cclxuXHRcdFx0aWYgKCAhIGNvbnRyb2wuZmllbGRzLnRpdGxlLmlzKCBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICkgKSB7XHJcblx0XHRcdFx0c3luY0lucHV0ID0gY29udHJvbC5zeW5jQ29udGFpbmVyLmZpbmQoICcuc3luYy1pbnB1dC50aXRsZScgKTtcclxuXHRcdFx0XHRjb250cm9sLmZpZWxkcy50aXRsZS52YWwoIHN5bmNJbnB1dC52YWwoKSApO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzeW5jSW5wdXQgPSBjb250cm9sLnN5bmNDb250YWluZXIuZmluZCggJy5zeW5jLWlucHV0LnRleHQnICk7XHJcblx0XHRcdGlmICggY29udHJvbC5maWVsZHMudGV4dC5pcyggJzp2aXNpYmxlJyApICkge1xyXG5cdFx0XHRcdGlmICggISBjb250cm9sLmZpZWxkcy50ZXh0LmlzKCBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICkgKSB7XHJcblx0XHRcdFx0XHRjb250cm9sLmZpZWxkcy50ZXh0LnZhbCggc3luY0lucHV0LnZhbCgpICk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2UgaWYgKCBjb250cm9sLmVkaXRvciAmJiAhIGNvbnRyb2wuZWRpdG9yRm9jdXNlZCAmJiBzeW5jSW5wdXQudmFsKCkgIT09IGNvbnRyb2wuZmllbGRzLnRleHQudmFsKCkgKSB7XHJcblx0XHRcdFx0Y29udHJvbC5lZGl0b3Iuc2V0Q29udGVudCggd3Aub2xkRWRpdG9yLmF1dG9wKCBzeW5jSW5wdXQudmFsKCkgKSApO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogSW5pdGlhbGl6ZSBlZGl0b3IuXHJcblx0XHQgKlxyXG5cdFx0ICogQHJldHVybiB7dm9pZH1cclxuXHRcdCAqL1xyXG5cdFx0aW5pdGlhbGl6ZUVkaXRvcjogZnVuY3Rpb24gaW5pdGlhbGl6ZUVkaXRvcigpIHtcclxuXHRcdFx0dmFyIGNvbnRyb2wgPSB0aGlzLCBjaGFuZ2VEZWJvdW5jZURlbGF5ID0gMTAwMCwgaWQsIHRleHRhcmVhLCB0cmlnZ2VyQ2hhbmdlSWZEaXJ0eSwgcmVzdG9yZVRleHRNb2RlID0gZmFsc2UsIG5lZWRzVGV4dGFyZWFDaGFuZ2VUcmlnZ2VyID0gZmFsc2UsIHByZXZpb3VzVmFsdWU7XHJcblx0XHRcdHRleHRhcmVhID0gY29udHJvbC5maWVsZHMudGV4dDtcclxuXHRcdFx0aWQgPSB0ZXh0YXJlYS5hdHRyKCAnaWQnICk7XHJcblx0XHRcdHByZXZpb3VzVmFsdWUgPSB0ZXh0YXJlYS52YWwoKTtcclxuXHJcblx0XHRcdC8qKlxyXG5cdFx0XHQgKiBUcmlnZ2VyIGNoYW5nZSBpZiBkaXJ0eS5cclxuXHRcdFx0ICpcclxuXHRcdFx0ICogQHJldHVybiB7dm9pZH1cclxuXHRcdFx0ICovXHJcblx0XHRcdHRyaWdnZXJDaGFuZ2VJZkRpcnR5ID0gZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0dmFyIHVwZGF0ZVdpZGdldEJ1ZmZlciA9IDMwMDsgLy8gU2VlIHdwLmN1c3RvbWl6ZS5XaWRnZXRzLldpZGdldENvbnRyb2wuX3NldHVwVXBkYXRlVUkoKSB3aGljaCB1c2VzIDI1MG1zIGZvciB1cGRhdGVXaWRnZXREZWJvdW5jZWQuXHJcblx0XHRcdFx0aWYgKCBjb250cm9sLmVkaXRvci5pc0RpcnR5KCkgKSB7XHJcblxyXG5cdFx0XHRcdFx0LypcclxuXHRcdFx0XHRcdCAqIEFjY291bnQgZm9yIHJhY2UgY29uZGl0aW9uIGluIGN1c3RvbWl6ZXIgd2hlcmUgdXNlciBjbGlja3MgU2F2ZSAmIFB1Ymxpc2ggd2hpbGVcclxuXHRcdFx0XHRcdCAqIGZvY3VzIHdhcyBqdXN0IHByZXZpb3VzbHkgZ2l2ZW4gdG8gdGhlIGVkaXRvci4gU2luY2UgdXBkYXRlcyB0byB0aGUgZWRpdG9yXHJcblx0XHRcdFx0XHQgKiBhcmUgZGVib3VuY2VkIGF0IDEgc2Vjb25kIGFuZCBzaW5jZSB3aWRnZXQgaW5wdXQgY2hhbmdlcyBhcmUgb25seSBzeW5jZWQgdG9cclxuXHRcdFx0XHRcdCAqIHNldHRpbmdzIGFmdGVyIDI1MG1zLCB0aGUgY3VzdG9taXplciBuZWVkcyB0byBiZSBwdXQgaW50byB0aGUgcHJvY2Vzc2luZ1xyXG5cdFx0XHRcdFx0ICogc3RhdGUgZHVyaW5nIHRoZSB0aW1lIGJldHdlZW4gdGhlIGNoYW5nZSBldmVudCBpcyB0cmlnZ2VyZWQgYW5kIHVwZGF0ZVdpZGdldFxyXG5cdFx0XHRcdFx0ICogbG9naWMgc3RhcnRzLiBOb3RlIHRoYXQgdGhlIGRlYm91bmNlZCB1cGRhdGUtd2lkZ2V0IHJlcXVlc3Qgc2hvdWxkIGJlIGFibGVcclxuXHRcdFx0XHRcdCAqIHRvIGJlIHJlbW92ZWQgd2l0aCB0aGUgcmVtb3ZhbCBvZiB0aGUgdXBkYXRlLXdpZGdldCByZXF1ZXN0IGVudGlyZWx5IG9uY2VcclxuXHRcdFx0XHRcdCAqIHdpZGdldHMgYXJlIGFibGUgdG8gbXV0YXRlIHRoZWlyIG93biBpbnN0YW5jZSBwcm9wcyBkaXJlY3RseSBpbiBKUyB3aXRob3V0XHJcblx0XHRcdFx0XHQgKiBoYXZpbmcgdG8gbWFrZSBzZXJ2ZXIgcm91bmQtdHJpcHMgdG8gY2FsbCB0aGUgcmVzcGVjdGl2ZSBXUF9XaWRnZXQ6OnVwZGF0ZSgpXHJcblx0XHRcdFx0XHQgKiBjYWxsYmFja3MuIFNlZSA8aHR0cHM6Ly9jb3JlLnRyYWMud29yZHByZXNzLm9yZy90aWNrZXQvMzM1MDc+LlxyXG5cdFx0XHRcdFx0ICovXHJcblx0XHRcdFx0XHRpZiAoIHdwLmN1c3RvbWl6ZSAmJiB3cC5jdXN0b21pemUuc3RhdGUgKSB7XHJcblx0XHRcdFx0XHRcdHdwLmN1c3RvbWl6ZS5zdGF0ZSggJ3Byb2Nlc3NpbmcnICkuc2V0KCB3cC5jdXN0b21pemUuc3RhdGUoICdwcm9jZXNzaW5nJyApLmdldCgpICsgMSApO1xyXG5cdFx0XHRcdFx0XHRfLmRlbGF5KCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0XHR3cC5jdXN0b21pemUuc3RhdGUoICdwcm9jZXNzaW5nJyApLnNldCggd3AuY3VzdG9taXplLnN0YXRlKCAncHJvY2Vzc2luZycgKS5nZXQoKSAtIDEgKTtcclxuXHRcdFx0XHRcdFx0fSwgdXBkYXRlV2lkZ2V0QnVmZmVyICk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKCAhIGNvbnRyb2wuZWRpdG9yLmlzSGlkZGVuKCkgKSB7XHJcblx0XHRcdFx0XHRcdGNvbnRyb2wuZWRpdG9yLnNhdmUoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdC8vIFRyaWdnZXIgY2hhbmdlIG9uIHRleHRhcmVhIHdoZW4gaXQgaGFzIGNoYW5nZWQgc28gdGhlIHdpZGdldCBjYW4gZW50ZXIgYSBkaXJ0eSBzdGF0ZS5cclxuXHRcdFx0XHRpZiAoIG5lZWRzVGV4dGFyZWFDaGFuZ2VUcmlnZ2VyICYmIHByZXZpb3VzVmFsdWUgIT09IHRleHRhcmVhLnZhbCgpICkge1xyXG5cdFx0XHRcdFx0dGV4dGFyZWEudHJpZ2dlciggJ2NoYW5nZScgKTtcclxuXHRcdFx0XHRcdG5lZWRzVGV4dGFyZWFDaGFuZ2VUcmlnZ2VyID0gZmFsc2U7XHJcblx0XHRcdFx0XHRwcmV2aW91c1ZhbHVlID0gdGV4dGFyZWEudmFsKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gSnVzdC1pbi10aW1lIGZvcmNlLXVwZGF0ZSB0aGUgaGlkZGVuIGlucHV0IGZpZWxkcy5cclxuXHRcdFx0Y29udHJvbC5zeW5jQ29udGFpbmVyLmNsb3Nlc3QoICcud2lkZ2V0JyApLmZpbmQoICdbbmFtZT1zYXZld2lkZ2V0XTpmaXJzdCcgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gb25DbGlja1NhdmVCdXR0b24oKSB7XHJcblx0XHRcdFx0dHJpZ2dlckNoYW5nZUlmRGlydHkoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogQnVpbGQgKG9yIHJlLWJ1aWxkKSB0aGUgdmlzdWFsIGVkaXRvci5cclxuXHRcdFx0ICpcclxuXHRcdFx0ICogQHJldHVybiB7dm9pZH1cclxuXHRcdFx0ICovXHJcblx0XHRcdGZ1bmN0aW9uIGJ1aWxkRWRpdG9yKCkge1xyXG5cdFx0XHRcdHZhciBlZGl0b3IsIG9uSW5pdCwgc2hvd1BvaW50ZXJFbGVtZW50O1xyXG5cclxuXHRcdFx0XHQvLyBBYm9ydCBidWlsZGluZyBpZiB0aGUgdGV4dGFyZWEgaXMgZ29uZSwgbGlrZWx5IGR1ZSB0byB0aGUgd2lkZ2V0IGhhdmluZyBiZWVuIGRlbGV0ZWQgZW50aXJlbHkuXHJcblx0XHRcdFx0aWYgKCAhIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBpZCApICkge1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gVGhlIHVzZXIgaGFzIGRpc2FibGVkIFRpbnlNQ0UuXHJcblx0XHRcdFx0aWYgKCB0eXBlb2Ygd2luZG93LnRpbnltY2UgPT09ICd1bmRlZmluZWQnICkge1xyXG5cdFx0XHRcdFx0d3Aub2xkRWRpdG9yLmluaXRpYWxpemUoIGlkLCB7XHJcblx0XHRcdFx0XHRcdHF1aWNrdGFnczogdHJ1ZSxcclxuXHRcdFx0XHRcdFx0bWVkaWFCdXR0b25zOiB0cnVlXHJcblx0XHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBEZXN0cm95IGFueSBleGlzdGluZyBlZGl0b3Igc28gdGhhdCBpdCBjYW4gYmUgcmUtaW5pdGlhbGl6ZWQgYWZ0ZXIgYSB3aWRnZXQtdXBkYXRlZCBldmVudC5cclxuXHRcdFx0XHRpZiAoIHRpbnltY2UuZ2V0KCBpZCApICkge1xyXG5cdFx0XHRcdFx0cmVzdG9yZVRleHRNb2RlID0gdGlueW1jZS5nZXQoIGlkICkuaXNIaWRkZW4oKTtcclxuXHRcdFx0XHRcdHdwLm9sZEVkaXRvci5yZW1vdmUoIGlkICk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvLyBBZGQgb3IgZW5hYmxlIHRoZSBgd3B2aWV3YCBwbHVnaW4uXHJcblx0XHRcdFx0JCggZG9jdW1lbnQgKS5vbmUoICd3cC1iZWZvcmUtdGlueW1jZS1pbml0LnRleHQtd2lkZ2V0LWluaXQnLCBmdW5jdGlvbiggZXZlbnQsIGluaXQgKSB7XHJcblx0XHRcdFx0XHQvLyBJZiBzb21lYm9keSBoYXMgcmVtb3ZlZCBhbGwgcGx1Z2lucywgdGhleSBtdXN0IGhhdmUgYSBnb29kIHJlYXNvbi5cclxuXHRcdFx0XHRcdC8vIEtlZXAgaXQgdGhhdCB3YXkuXHJcblx0XHRcdFx0XHRpZiAoICEgaW5pdC5wbHVnaW5zICkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHR9IGVsc2UgaWYgKCAhIC9cXGJ3cHZpZXdcXGIvLnRlc3QoIGluaXQucGx1Z2lucyApICkge1xyXG5cdFx0XHRcdFx0XHRpbml0LnBsdWdpbnMgKz0gJyx3cHZpZXcnO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0gKTtcclxuXHJcblx0XHRcdFx0d3Aub2xkRWRpdG9yLmluaXRpYWxpemUoIGlkLCB7XHJcblx0XHRcdFx0XHR0aW55bWNlOiB7XHJcblx0XHRcdFx0XHRcdHdwYXV0b3A6IHRydWVcclxuXHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHRxdWlja3RhZ3M6IHRydWUsXHJcblx0XHRcdFx0XHRtZWRpYUJ1dHRvbnM6IHRydWVcclxuXHRcdFx0XHR9KTtcclxuXHJcblx0XHRcdFx0LyoqXHJcblx0XHRcdFx0ICogU2hvdyBhIHBvaW50ZXIsIGZvY3VzIG9uIGRpc21pc3MsIGFuZCBzcGVhayB0aGUgY29udGVudHMgZm9yIGExMXkuXHJcblx0XHRcdFx0ICpcclxuXHRcdFx0XHQgKiBAcGFyYW0ge2pRdWVyeX0gcG9pbnRlckVsZW1lbnQgUG9pbnRlciBlbGVtZW50LlxyXG5cdFx0XHRcdCAqIEByZXR1cm4ge3ZvaWR9XHJcblx0XHRcdFx0ICovXHJcblx0XHRcdFx0c2hvd1BvaW50ZXJFbGVtZW50ID0gZnVuY3Rpb24oIHBvaW50ZXJFbGVtZW50ICkge1xyXG5cdFx0XHRcdFx0cG9pbnRlckVsZW1lbnQuc2hvdygpO1xyXG5cdFx0XHRcdFx0cG9pbnRlckVsZW1lbnQuZmluZCggJy5jbG9zZScgKS5mb2N1cygpO1xyXG5cdFx0XHRcdFx0d3AuYTExeS5zcGVhayggcG9pbnRlckVsZW1lbnQuZmluZCggJ2gzLCBwJyApLm1hcCggZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiAkKCB0aGlzICkudGV4dCgpO1xyXG5cdFx0XHRcdFx0fSApLmdldCgpLmpvaW4oICdcXG5cXG4nICkgKTtcclxuXHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRlZGl0b3IgPSB3aW5kb3cudGlueW1jZS5nZXQoIGlkICk7XHJcblx0XHRcdFx0aWYgKCAhIGVkaXRvciApIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBFcnJvciggJ0ZhaWxlZCB0byBpbml0aWFsaXplIGVkaXRvcicgKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0b25Jbml0ID0gZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0XHRcdFx0Ly8gV2hlbiBhIHdpZGdldCBpcyBtb3ZlZCBpbiB0aGUgRE9NIHRoZSBkeW5hbWljYWxseS1jcmVhdGVkIFRpbnlNQ0UgaWZyYW1lIHdpbGwgYmUgZGVzdHJveWVkIGFuZCBoYXMgdG8gYmUgcmUtYnVpbHQuXHJcblx0XHRcdFx0XHQkKCBlZGl0b3IuZ2V0V2luKCkgKS5vbiggJ3VubG9hZCcsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRfLmRlZmVyKCBidWlsZEVkaXRvciApO1xyXG5cdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSWYgYSBwcmlvciBtY2UgaW5zdGFuY2Ugd2FzIHJlcGxhY2VkLCBhbmQgaXQgd2FzIGluIHRleHQgbW9kZSwgdG9nZ2xlIHRvIHRleHQgbW9kZS5cclxuXHRcdFx0XHRcdGlmICggcmVzdG9yZVRleHRNb2RlICkge1xyXG5cdFx0XHRcdFx0XHRzd2l0Y2hFZGl0b3JzLmdvKCBpZCwgJ2h0bWwnICk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly8gU2hvdyB0aGUgcG9pbnRlci5cclxuXHRcdFx0XHRcdCQoICcjJyArIGlkICsgJy1odG1sJyApLm9uKCAnY2xpY2snLCBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0Y29udHJvbC5wYXN0ZUh0bWxQb2ludGVyLmhpZGUoKTsgLy8gSGlkZSB0aGUgSFRNTCBwYXN0aW5nIHBvaW50ZXIuXHJcblxyXG5cdFx0XHRcdFx0XHRpZiAoIC0xICE9PSB3cC50ZXh0V2lkZ2V0cy5kaXNtaXNzZWRQb2ludGVycy5pbmRleE9mKCAndGV4dF93aWRnZXRfY3VzdG9tX2h0bWwnICkgKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdHNob3dQb2ludGVyRWxlbWVudCggY29udHJvbC5jdXN0b21IdG1sV2lkZ2V0UG9pbnRlciApO1xyXG5cdFx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdFx0Ly8gSGlkZSB0aGUgcG9pbnRlciB3aGVuIHN3aXRjaGluZyB0YWJzLlxyXG5cdFx0XHRcdFx0JCggJyMnICsgaWQgKyAnLXRtY2UnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xyXG5cdFx0XHRcdFx0XHRjb250cm9sLmN1c3RvbUh0bWxXaWRnZXRQb2ludGVyLmhpZGUoKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0XHRcdC8vIFNob3cgcG9pbnRlciB3aGVuIHBhc3RpbmcgSFRNTC5cclxuXHRcdFx0XHRcdGVkaXRvci5vbiggJ3Bhc3RlcHJlcHJvY2VzcycsIGZ1bmN0aW9uKCBldmVudCApIHtcclxuXHRcdFx0XHRcdFx0dmFyIGNvbnRlbnQgPSBldmVudC5jb250ZW50O1xyXG5cdFx0XHRcdFx0XHRpZiAoIC0xICE9PSB3cC50ZXh0V2lkZ2V0cy5kaXNtaXNzZWRQb2ludGVycy5pbmRleE9mKCAndGV4dF93aWRnZXRfcGFzdGVfaHRtbCcgKSB8fCAhIGNvbnRlbnQgfHwgISAvJmx0O1xcdysuKj8mZ3Q7Ly50ZXN0KCBjb250ZW50ICkgKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0XHQvLyBTaG93IHRoZSBwb2ludGVyIGFmdGVyIGEgc2xpZ2h0IGRlbGF5IHNvIHRoZSB1c2VyIHNlZXMgd2hhdCB0aGV5IHBhc3RlZC5cclxuXHRcdFx0XHRcdFx0Xy5kZWxheSggZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdFx0c2hvd1BvaW50ZXJFbGVtZW50KCBjb250cm9sLnBhc3RlSHRtbFBvaW50ZXIgKTtcclxuXHRcdFx0XHRcdFx0fSwgMjUwICk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9O1xyXG5cclxuXHRcdFx0XHRpZiAoIGVkaXRvci5pbml0aWFsaXplZCApIHtcclxuXHRcdFx0XHRcdG9uSW5pdCgpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRlZGl0b3Iub24oICdpbml0Jywgb25Jbml0ICk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjb250cm9sLmVkaXRvckZvY3VzZWQgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0ZWRpdG9yLm9uKCAnZm9jdXMnLCBmdW5jdGlvbiBvbkVkaXRvckZvY3VzKCkge1xyXG5cdFx0XHRcdFx0Y29udHJvbC5lZGl0b3JGb2N1c2VkID0gdHJ1ZTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHRlZGl0b3Iub24oICdwYXN0ZScsIGZ1bmN0aW9uIG9uRWRpdG9yUGFzdGUoKSB7XHJcblx0XHRcdFx0XHRlZGl0b3Iuc2V0RGlydHkoIHRydWUgKTsgLy8gQmVjYXVzZSBwYXN0aW5nIGRvZXNuJ3QgY3VycmVudGx5IHNldCB0aGUgZGlydHkgc3RhdGUuXHJcblx0XHRcdFx0XHR0cmlnZ2VyQ2hhbmdlSWZEaXJ0eSgpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHRcdGVkaXRvci5vbiggJ05vZGVDaGFuZ2UnLCBmdW5jdGlvbiBvbk5vZGVDaGFuZ2UoKSB7XHJcblx0XHRcdFx0XHRuZWVkc1RleHRhcmVhQ2hhbmdlVHJpZ2dlciA9IHRydWU7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdFx0ZWRpdG9yLm9uKCAnTm9kZUNoYW5nZScsIF8uZGVib3VuY2UoIHRyaWdnZXJDaGFuZ2VJZkRpcnR5LCBjaGFuZ2VEZWJvdW5jZURlbGF5ICkgKTtcclxuXHRcdFx0XHRlZGl0b3Iub24oICdibHVyIGhpZGUnLCBmdW5jdGlvbiBvbkVkaXRvckJsdXIoKSB7XHJcblx0XHRcdFx0XHRjb250cm9sLmVkaXRvckZvY3VzZWQgPSBmYWxzZTtcclxuXHRcdFx0XHRcdHRyaWdnZXJDaGFuZ2VJZkRpcnR5KCk7XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cdFx0XHRcdGNvbnRyb2wuZWRpdG9yID0gZWRpdG9yO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRidWlsZEVkaXRvcigpO1xyXG5cdFx0fVxyXG5cdH0pO1xyXG59KSggalF1ZXJ5ICk7Il19